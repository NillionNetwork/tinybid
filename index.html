<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>tinybid: Secure Single-Item First-Price Auction Demo</title>
    <script>
      var favIcon = "iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAGFBMVEUAAABHcEwAAAAAAAAAAAAAAAAAAAAAAACpMnD0AAAAB3RSTlNjAL+fpPk8rO4B2AAAADNJREFUGJVjYEQDDIxsLMxwwMIGFGBgRwIMOAVYgQBZgAlkHNMgEwB6joUB7E8WiOfQAADiPANLertncwAAAABJRU5ErkJggg==";
      var docHead = document.getElementsByTagName('head')[0];
      var newLink = document.createElement('link');
      newLink.rel = 'shortcut icon';
      newLink.type = 'image/x-icon';
      newLink.href = 'data:image/png;base64,'+favIcon;
      docHead.appendChild(newLink);
    </script>
    <link rel="stylesheet" href="https://pyscript.net/latest/pyscript.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Cabin:wght@300;400;500;700" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.5.1/css/all.css" />
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" 
          integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <style>
      /*****************
       * Color scheme. *
       *****************/
      :root {
        --color-text:#000000;
        --color-background:#FFFFFF;
        --color-link:#0000FF;
        --color-link-hover:#000000;
        --color-interactive:#0000FF;
        --color-interactive-text:#FFFFFF;
        --color-interactive-text-disabled:#777777;
        --color-interactive-hover:#000000;
        --color-interactive-disabled-light:#CCCCCC;
        --color-interactive-disabled-dark:#444444;
        --color-interactive-shadow:#555555;
        --color-separator:#000000;
        --color-client-background:#FFFFFF;
        --color-client-border:#000000;
        --color-client-text:#000000;
        --color-node-background:#00003F;
        --color-node-border:#00003F;
        --color-node-text:#FFFFFF;
        --color-diagram-edge:#000000;
        --color-footer-background:#0000FF;
        --color-footer-text:#FFFFFF;
        --color-footer-link:#FFFFFF;
        --color-footer-link-hover:#FFFFFF;
      }

      /******************************************
       * Customizations of common dependencies. *
       ******************************************/
      #pyscript_loading_splash { z-index:8192; }

      /********************************************* 
       * High-level page layout, look, and design. *
       *********************************************/
      html { height:100vh; }
      body {
        display:flex; flex-direction:column;
        min-height:100vh;
        min-width:500px !important;
        padding:0px 0px 0px 0px;
        background-color:var(--color-background);
        font-family:'Cabin',sans-serif;
        color:var(--color-text);
      }
      .container > .row { margin-bottom:8px; }
      .card-deck .card { border:0px; min-width:220px; }
      .card {
        min-width:350px !important;
        background-color:var(--color-background);
        color:var(--color-text);
      }
      .card-body { padding:2px 10px 2px 10px; line-height:18px; font-size:14px; }
      a { font-weight:bold; text-decoration:none; color:var(--color-link); }
      a:hover { text-decoration:none; color:var(--color-link-hover); }
      .header { min-height:100px; margin-top:60px; margin-bottom:20px; }
      hr { margin:0px; border-top:1px solid var(--color-separator) !important; opacity:1; }
      h1 { text-align:left; }
      h2 { margin-top:10px; line-height:24px; font-size:18px; font-weight:normal; }
      h3 {
        width:100%;
        margin-bottom:0px;
        padding:0px 0px 6px 0px;
        text-align:left;
        white-space:nowrap;
        font-size:20px;
      }
      .footer-spacer { margin-top:70px; }
      footer {
        width:100%;
        margin:auto auto 0 auto;
        padding:16px 0px 16px 0px;
        background-color:var(--color-footer-background);
        color:var(--color-footer-text);
      }
      footer a { color:var(--color-footer-link); }
      footer a:hover { color:var(--color-footer-link-hover); }
      footer .card-deck { margin-bottom:0px !important; }
      footer .card { margin-bottom:0px !important; border:0px; background-color:var(--color-footer-background); }
      footer .card-body-items { padding:8px 20px 0px 20px; }
      footer .card-body-items-left { float:left; }
      footer .card-body-items-right { float:right; }
      footer .card-deck-copyright { height:26x !important; font-size:10px; }
      footer .card-copyright { height:26px !important; padding:0px 16px 0px 16px; font-size:12px !important; }
      footer .license-phrase { color:var(--color-footer-text); }
      footer .item { margin:0px 25px 0px 0px; white-space:nowrap; font-size:14px; }
      footer .icon { margin:0px 15px 0px 0px; font-size:20px; }
      footer .icon:last-child { margin-right:0px; font-size:18px; }
      .noselect {
        -webkit-touch-callout:none; /* iOS Safari */
          -webkit-user-select:none; /* Safari */
           -khtml-user-select:none; /* Konqueror HTML */
             -moz-user-select:none; /* Old versions of Firefox */
              -ms-user-select:none; /* Internet Explorer/Edge */
                  user-select:none; /* Non-prefixed version, currently
                                       supported by Chrome, Edge, Opera and Firefox */
      }
      @media (min-width: 768px) { html { font-size:16px; } }
      @media all and (max-width:618px) { .header { margin-top:50px; } }


      /************************************************************
       * Layout for steps and data flow visualization containers. *
       ************************************************************/
      .grid-row { display:grid; grid-auto-rows:auto; grid-row-gap:0px; grid-column-gap:0px; }
      .grid-col { padding:0px 6px 0px 6px; }
      .grid-row-clients { grid-template-columns:3fr 2.25fr 2.25fr 2.25fr 2.25fr; }
      .grid-row-nodes { grid-template-columns:3fr 3fr 3fr 3fr; }
      .grid-row-recipient { grid-template-columns:3fr 9fr; }
      .grid-row-diagram { grid-template-columns:3fr 9fr; }
      .grid-row-diagram .grid-col { height:100px; }

      /**************************************************** 
       * Guidance/expository content layout and behavior. *
       ****************************************************/
      .step > ol > li { margin-left:8px; font-size:42px; font-weight:bold; }
      .step > ol > li > div {
        position:relative;
        top:-16px;
        padding-right:8px;
        line-height:24px; 
        font-size:18px; font-weight:normal;
      }
      @media all and (max-width:991px) { 
        .step > ol > li { font-size:32px; }
        .step > ol > li > div { top:-10px; padding-right:0px; line-height:20px; font-size:18px; }
      }
      @media all and (max-width:767px) {
        .step > ol { margin-left:-12px; }
        .step > ol > li { font-size:26px; }
        .step > ol > li > div { top:-10px; padding-right:0px; line-height:14px; font-size:12px; }
      }

      /***********************************************************
       * Panel elements (representing parties) and their layout. *
       ***********************************************************/
      .panel { height:100%; width:100%; margin:0px 10px 0px 0px; padding:0px 10px 0px 10px; }
      .entity { height:100%; margin-top:0px; padding:20px 24px 20px 24px; }
      .entity > div { display:table; height:100%; width:100%; }
      .entity > div > div { display:table-row; }
      .entity > div > div > div { display:table-cell; padding-bottom:14px; text-align:center; }
      .entity > div > div:last-child > div { vertical-align:bottom; } /* Usually client buttons. */
      .client {
        border:1px solid var(--color-client-border);
        background-color:var(--color-client-background);
        color:var(--color-client-text);
      }
      .node {
        border:1px solid var(--color-node-border);
        background-color:var(--color-node-background);
        color:var(--color-node-text);
      }
      .recipient > div > div > div { vertical-align:middle !important; } /* Usually output. */
      h3 { margin-bottom:6px; }
      h4 { margin-top:8px; padding-top:2px; text-align:center; line-height:16px !important; font-size:14px; }
      @media all and (max-width:991px) { 
        .client { padding:10px; }
        h3 { font-size:14px; }
      }
      @media all and (max-width:767px) {
        .panel { padding:0px; }
        .entity { padding:10px; }
        h4 { line-height:14px; font-size:12px !important; }
      }
      @media all and (max-width:575px) {
        .entity { height:100%; margin-top:0px; }
        h3 { font-size:14px; }
        h4 { line-height:12px !important; font-size:10px !important; }
      }

      /**************************************************** 
       * Interactive user interface (UI) common elements. *
       ****************************************************/
      .array { height:20px; margin:0px 4px 0px 4px; white-space:nowrap; }
      .array > span {
        padding:1px 4px 1px 4px;
        border-top:1px solid var(--color-text);
        border-left:1px solid var(--color-text);
        border-bottom:1px solid var(--color-text);
        font-size:12px; font-weight:bold;
      }
      .array > span:last-child { border-right:1px solid var(--color-text); }
      .bytes { position:relative; height:10px; margin:8px 4px 8px 4px; white-space:nowrap; }
      .bytes > span {
        position:relative; top:-2px;
        padding-right:24px;
        font-size:14px;
      }
      .bytes > table { height:100%; width:100%; }
      @media all and (max-width:539px) {
        .array > span { font-size:10px; }
        .bytes > span { font-size:10px; }
      }
      button {
        width:50px;
        margin:0px 2px 2px 0px;
        -webkit-box-shadow: 2px 2px 0px 0px var(--color-interactive-shadow);
        -moz-box-shadow: 2px 2px 0px 0px var(--color-interactive-shadow);
        box-shadow: 2px 2px 0px 0px var(--color-interactive-shadow);
        padding:8px;
        border:0px solid #000000;
        background-color:var(--color-interactive);
        color:var(--color-interactive-text);
      }
      button:hover { background-color:var(--color-interactive-hover); }
      button:active {
        margin:2px 0px 0px 2px;
        -webkit-box-shadow: 0px 0px 0px 0px var(--color-interactive-shadow);
        -moz-box-shadow: 0px 0px 0px 0px var(--color-interactive-shadow);
        box-shadow: 0px 0px 0px 0px var(--color-interactive-shadow);
      }
      button:disabled {
        background-color:var(--color-interactive-disabled-light);
        color:var(--color-interactive-text-disabled);
      }
      #recipient-output {
        margin-top:0px;
        padding:0px 20px 10px 20px;
        text-align:center;
        font-size:32px;
      }
      @media all and (max-width:767px) {
        button { font-size:14px; }
        #recipient-output { line-height:28px; font-size:24px; }
      }
      @media all and (max-width:575px) {
        button { line-height:12px !important; font-size:10px; }
        #recipient-output { margin-bottom:6px; line-height:24px; font-size:20px; }
      }

      /***************************************************************
       * Interactive user interface (UI) custom layout and elements. *
       ***************************************************************/
      .bid-price {
        margin-top:12px; margin-bottom:4px;
        text-align:center;
        font-size:18px; font-weight:bold;
        color:var(--color-interactive);
      }
      @media all and (max-width:767px) { .bid-price { font-size:16px; } }
      .entity > div > div > div > .ui-slider { display:inline-block; margin-bottom:10px; }
      .ui-slider { margin:18px 0px 6px 0px; width:20px; height:100px; }
      .ui-slider-range { background-color:var(--color-interactive); }
      .ui-slider-disabled .ui-slider-range { background-color:var(--color-interactive-disabled-dark); }
      .ui-slider .ui-slider-handle { font-size:30px; }
      .ui-slider .ui-state-hover { background-color:var(--color-interactive); }
      .ui-slider .ui-state-active { background-color:var(--color-interactive); }
    </style>
  </head>
  <body>
    <div class="container header">
      <div class="card-deck mb-3">
        <div class="card mb-4">
          <div class="card-body">
            <h1><b>tinybid</b>: Secure Single-Item First-Price Auction Demo</h1>
            <hr/>
            <h2>
              <p>
                This secure single-item first-price auction demo (source code <a href="https://github.com/nillion-oss/tinybid/tree/gh-pages">available on GitHub</a>) simulates a secure multi-party computation (MPC) protocol <b>entirely in your browser</b> by importing and invoking the <a href="https://github.com/nillion-oss/tinybid">tinybid</a> and underlying <a href="https://github.com/nillion-oss/tinynmc">tinynmc</a> libraries using <a href="https://pyscript.net">PyScript</a>.
              </p>
              <p>
                Within the <a href="https://github.com/nillion-oss/tinybid?tab=readme-ov-file#implementation">implementation</a> of the library, vectors of <a href="https://en.wikipedia.org/wiki/Finite_field">finite field</a> elements are used to represent both submitted bids and the overall outcome of an auction. In the visualizations below, instances of these data structures are rendered using a variant of a <a href="https://en.wikipedia.org/wiki/Heat_map">heat map</a> in which the brightness value corresponds to the difference between the finite field element and zero. For example, a vector such as
                <span class="array">
                  <span>1 mod 11</span><span>5 mod 11</span><span>8 mod 11</span><span>3 mod 11</span><span>10 mod 11</span>
                </span>
                would be represented by
                <span class="bytes" style="margin-right:-2px;">
                  <span style="background-color:rgb(25,25,25);">&nbsp;</span><span style="background-color:rgb(128,128,128);"></span><span style="background-color:rgb(200,200,200);"></span><span style=" background-color:rgb(80,80,80);"></span><span style="background-color:rgb(230,230,230);"></span>
                </span>.
                Note also that bidders and nodes are numbered starting from zero so that their interface identifiers match their indices in the source code.
              </p>
            </h2>
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="grid-row grid-row-clients">
        <div class="grid-col">
          <div class="step">
            <ol start="1">
              <li>
                <div>
                  For each bidder, use the slider to choose a bid value and then click <b>Bid</b>. The bids are encoded as vectors, masks are requested from the nodes, and the masked vectors are broadcast to all the nodes.
                </div>
              </li>
            </ol>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel">
            <div class="entity client">
              <div>
                <div><h3>Bidder 0</h3></div>
                <div>
                  <div>
                    <div class="bid-price noselect" id="bid-price-0"></div>
                    <div id="bid-slider-0"></div>
                  </div>
                </div>
                <div><div><button id="bid-0">Bid</button></div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel">
            <div class="entity client">
              <div>
                <div><h3>Bidder 1</h3></div>
                <div>
                  <div>
                    <div class="bid-price noselect" id="bid-price-1"></div>
                    <div id="bid-slider-1"></div>
                  </div>
                </div>
                <div><div><button id="bid-1">Bid</button></div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel">
            <div class="entity client">
              <div>
                <div><h3>Bidder 2</h3></div>
                <div>
                  <div>
                    <div class="bid-price noselect" id="bid-price-2"></div>
                    <div id="bid-slider-2"></div>
                  </div>
                </div>
               <div><div><button id="bid-2">Bid</button></div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel">
            <div class="entity client">
              <div>
                <div><h3>Bidder 3</h3></div>
                <div>
                  <div>
                    <div class="bid-price noselect" id="bid-price-3"></div>
                    <div id="bid-slider-3"></div>
                  </div>
                </div>
                <div><div><button id="bid-3">Bid</button></div></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="grid-row grid-row-diagram">
        <div class="grid-col"></div>
        <div class="grid-col">
          <div id="diagram-input"></div>
        </div>
      </div>
      <div class="grid-row grid-row-nodes">
        <div class="grid-col">
          <div class="step" id="step-nodes">
            <ol start="2">
              <li>
                <div>
                  Each node receives the masked vectors corresponding to the four bids, and then locally computes its secret share of the overall result vector.
                </div>
              </li>
            </ol>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel">
            <div class="entity node" id="node-0">
              <div>
                <div><h3>Node 0</h3></div>
                <div>
                  <div>
                    <h4 class="noselect" id="node-0-bids-title">Masked Bids</h4>
                    <div class="bytes" id="bid-masked-0-at-node-0"></div>
                    <div class="bytes" id="bid-masked-1-at-node-0"></div>
                    <div class="bytes" id="bid-masked-2-at-node-0"></div>
                    <div class="bytes" id="bid-masked-3-at-node-0"></div>
                  </div>
                </div>
                <div>
                  <div>
                    <h4 class="noselect" id="node-0-share-title">Secret Share of Outcome</h4>
                    <div class="bytes" id="share-at-node-0"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel">
            <div class="entity node" id="node-1">
              <div>
                <div><h3>Node 1</h3></div>
                <div>
                  <div>
                    <h4 class="noselect" id="node-1-bids-title">Masked Bids</h4>
                    <div class="bytes" id="bid-masked-0-at-node-1"></div>
                    <div class="bytes" id="bid-masked-1-at-node-1"></div>
                    <div class="bytes" id="bid-masked-2-at-node-1"></div>
                    <div class="bytes" id="bid-masked-3-at-node-1"></div>
                  </div>
                </div>
                <div>
                  <div>
                    <h4 class="noselect" id="node-1-share-title">Secret Share of Outcome</h4>
                    <div class="bytes" id="share-at-node-1"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel">
            <div class="entity node" id="node-2">
              <div>
                <div><h3>Node 2</h3></div>
                <div>
                  <div>
                    <h4 class="noselect" id="node-2-bids-title">Masked Bids</h4>
                    <div class="bytes" id="bid-masked-0-at-node-2"></div>
                    <div class="bytes" id="bid-masked-1-at-node-2"></div>
                    <div class="bytes" id="bid-masked-2-at-node-2"></div>
                    <div class="bytes" id="bid-masked-3-at-node-2"></div>
                  </div>
                </div>
                <div>
                  <div>
                    <h4 class="noselect" id="node-2-share-title">Secret Share of Outcome</h4>
                    <div class="bytes" id="share-at-node-2"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="grid-row grid-row-diagram">
        <div class="grid-col"></div>
        <div class="grid-col">
          <div id="diagram-output"></div>
        </div>
      </div>
      <div class="grid-row grid-row-recipient">
        <div class="grid-col">
          <div class="step" id="step-recipient">
            <ol start="3">
              <li>
                <div>
                  The auction operator receives the secret shares of the result vector from each node and reconstructs it to determine the winner and their bid.
                </div>
              </li>
            </ol>
          </div>
        </div>
        <div class="grid-col">
          <div class="panel">
            <div class="entity client recipient" id="recipient">
              <div>
                <div><h3>Network Output</h3></div>
                <div>
                  <div>
                    <div id="recipient-output"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="footer-spacer"></div>
    <footer>
      <div class="container noselect">
        <div class="card-deck mb-3">
          <div class="card mb-4">
            <div class="card-body card-body-items">
              <div class="card-body-items-left">
                <span class="item">
                  <span class="license-phrase">Made available under the </span>
                  <a href="https://opensource.org/license/mit/">MIT License</a>
                </span>
              </div>
              <div class="card-body-items-right">
                <span class="icon"><a href="mailto:engineering@nillion.com"><i class="far fa-envelope"></i></a></span>
                <span class="icon"><a href="https://github.com/nillion-oss"><i class="fab fa-github"></i></a></span>
              </div>
            </div>
          </div>
        </div>
        <div class="card-deck mb-3 card-deck-copyright">
          <div class="card mb-4 card-copyright"></div>
        </div>
      </div>
    </footer>
    <py-config>
      packages = ["tinybid~=0.2"]
    </py-config>
    <section class="pyscript">
      <py-script>
        from pyodide.ffi import create_proxy
        import js
        from tinybid import *

        def modulo_to_uint8(m):
            return (256 * int(m)) // m.modulus

        def compute_outcome_if_ready():
            if all(bid is not None for bid in bids):
                shares = [node.outcome(bids) for node in nodes]
                for node_id in range(3):
                    js.nodeShowShare(
                        node_id,
                        [modulo_to_uint8(value) for value in shares[node_id]]
                    )
                result = list(sorted(reveal(shares)))
                js.recipientEnable()
                js.document.getElementById('recipient-output').innerHTML = \
                    'Winning bidder ID(s): ' + (', '.join([str(i) for i in result])) + '.'

        def make_bid_handler(bid_id):

            def bid_handler(_):
                request_ = request(identifier=bid_id)
                masks = [node.masks(request_) for node in nodes]
                price = js.clientGetPriceAndDisable(bid_id)
                bids[bid_id] = bid(masks, price)
                js.diagramInputUpdate()
                js.nodesEnable()
                for node_id in range(3):
                    js.nodeShowBidMasked(
                        bid_id, node_id,
                        [modulo_to_uint8(list(d.values())[0]) for d in bids[bid_id]]
                    )
                compute_outcome_if_ready()

            return bid_handler

        bids = [None, None, None, None]
        prices = 15
        nodes = [node(), node(), node()]
        preprocess(nodes, bids=len(bids), prices=prices)
        for bid_id in range(len(bids)):
            js.document.getElementById('bid-' + str(bid_id)).addEventListener(
                'click',
                create_proxy(make_bid_handler(bid_id))
            )
      </py-script>
    </section>
    <script defer src="https://pyscript.net/latest/pyscript.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
            integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous">
    </script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" 
            integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous">
    </script>
    <script>
      class Diagram {
        constructor (elementId, height, thickness) {
          this.element = document.getElementById(elementId);
          this.height = height;
          this.thickness = (thickness !== null) ? 2 : thickness;
          this.shows = {};
          this.element.style.position = "relative";
          this.element.style.height = height + "px";
        }

        edge (top, elementId, elementIds) {
          const edge = document.createElement("div");
          edge.style.position = "absolute";
          edge.style.top = top + "%";
          edge.style.border = this.thickness + "px solid var(--color-diagram-edge)";
          edge.style.opacity = 0;
          if (elementId !== null) {
            edge.id = elementId;
            this.shows[elementId] = (elementIds == null) ? [] : elementIds;
          }
          this.element.appendChild(edge);
          return edge;
        }

        vertical (index, total, top, height, elementId, elementIds) {
          const edge = this.edge(top, elementId, elementIds);
          edge.style.left = Math.round((100 * (1 + (2 * index))) / (2 * total))  + "%";
          edge.style.height = height + "%";
          edge.style.width = 0 + "px";
        }

        horizontal (total, top, elementId, elementIds) {
          const edge = this.edge(top, elementId, elementIds);
          const denom = 2 * total, left = Math.round(100 / denom);
          edge.style.left = left + "%";
          edge.style.height = 0 + "px";
          edge.style.width = "calc(" +
            this.thickness + "px + " + Math.round(100 - (100 / denom) - left) +
          "%)";
        }

        show (elementId) {
          document.getElementById(elementId).style.opacity = 1;
          if (elementId in this.shows) {
            for (let i = 0; i < this.shows[elementId].length; i++) {
              this.show(this.shows[elementId][i]);
            }
          }
        }
      }

      function showBytes(elementId, array) {
        const bytes = document.getElementById(elementId);
        bytes.classList.add("bytes");
        bytes.style.backgroundColor = "#FFFFFF";
        const table = document.createElement("table");
        table.style.width = "100%";
        const tr = document.createElement("tr");
        for (let i = 0; i < array.length; i++) {
          const td = document.createElement("td");
          td.style.backgroundColor = "rgb(" + array[i] + "," + array[i] + "," + array[i] + ")";
          tr.appendChild(td);
        }
        table.appendChild(tr);
        bytes.appendChild(table);
      }

      function setOpacities(opacity, elementIds) {
        elementIds.map(function(elementId) {
          document.getElementById(elementId).style.opacity = opacity;
        });
      }

      async function initialize() {
        setOpacities(0, [
            "node-0-bids-title", "node-0-share-title",
            "node-1-bids-title", "node-1-share-title",
            "node-2-bids-title", "node-2-share-title"
        ]);
        setOpacities(0.2, [
            "step-nodes", "node-0", "node-1", "node-2",
            "step-recipient", "recipient"
        ]);

        diagramInput = new Diagram("diagram-input", 100);
        diagramInput.vertical(0, 4, 0, 50, "it0", ["ih"]);
        diagramInput.vertical(1, 4, 0, 50, "it1", ["ih"]);
        diagramInput.vertical(2, 4, 0, 50, "it2", ["ih"]);
        diagramInput.vertical(3, 4, 0, 50, "it3", ["ih"]);
        diagramInput.horizontal(9, 50, "ih", ["ib0", "ib1", "ib2"]);
        diagramInput.vertical(0, 9, 50, 50, "ib0");
        diagramInput.vertical(4, 9, 50, 50, "ib1");
        diagramInput.vertical(8, 9, 50, 50, "ib2");

        diagramOutput = new Diagram("diagram-output", 100);
        diagramOutput.vertical(0, 3, 0, 50, "ot0");
        diagramOutput.vertical(1, 3, 0, 50, "ot1");
        diagramOutput.vertical(2, 3, 0, 50, "ot2");
        diagramOutput.horizontal(3, 50, "oh");
        diagramOutput.vertical(0, 1, 50, 50, "ob0");

        for (let bidId = 0; bidId < bids.length; bidId++) {
          const price = Math.floor(Math.random() * (prices + 1));
          bids[bidId].price = price;
          document.getElementById("bid-price-" + bidId).innerHTML = price;
          $(function() {
            $("#bid-slider-" + bidId).slider({
              orientation: "vertical",
              range: "min",
              min: 0,
              max: prices - 1,
              value: price,
              slide: function(event, ui) {
                document.getElementById("bid-price-" + bidId).innerHTML = ui.value;
                bids[bidId].price = ui.value;
              }
            });
          });
        }
      }

      function clientGetPriceAndDisable(bidId) {
        $("#bid-slider-" + bidId).slider("disable");
        document.getElementById("bid-" + bidId).disabled = true;
        bids[bidId].status = true;
        return bids[bidId].price;
      }

      function diagramInputUpdate() {
        for (let bidId = 0; bidId < bids.length; bidId++) {
          if (bids[bidId].status) {
            diagramInput.show("it" + bidId);
          }
        }
      }

      function nodesEnable() {
        setOpacities(1, ["step-nodes", "node-0", "node-1", "node-2"]);
      }

      function nodeShowBidMasked(bidId, nodeId, data) {
        setOpacities(1, ["node-" + nodeId + "-bids-title"]);
        showBytes("bid-masked-" + bidId + "-at-node-" + nodeId, Array.from(data));
      }

      function nodeShowShare(nodeId, data) {
        setOpacities(1, ["node-" + nodeId + "-share-title"]);
        showBytes("share-at-node-" + nodeId, Array.from(data));
      }

      function recipientEnable() {
        ["ot0", "ot1", "ot2", "oh", "ob0"].map( function(id) { diagramOutput.show(id); } );
        setOpacities(1, ["step-recipient", "recipient"]);
      }

      const bids = [{"price": 0}, {"price": 0}, {"price": 0}, {"price": 0}];
      const prices = 15
      let diagramInput = null, diagramOutput = null;
      window.onload = initialize;
    </script>
  </body>
</html>
